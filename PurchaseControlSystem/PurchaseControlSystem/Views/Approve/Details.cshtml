@*@model IEnumerable<PurchaseControlSystem.Models.Purchase_Transaction>*@
@model PurchaseControlSystem.ViewModel.PurchaseOrder_VM

@{
    ViewBag.Title = "Purchase Order Details";
    Layout = "~/Views/Shared/_head.cshtml";
}

<section class="light-bg p-5">
    <div class="container-fluid">
        <div class="row bg-white py-3">
            <div class="col-12 mb-3">
                <h5 class="mb-0 primary-bg text-white p-2 text-center rounded">Purchase Order Detail</h5>
            </div>

            <div class="col-md-3">
                <div class="d-block my-2">
                    <div class="d-inline-block rounded primary-bg text-white py-1 px-3 font w-50">
                        <span>Order no</span>
                    </div>
                    <div class="d-inline-block w-50">
                        @*@Html.EditorFor(model => model.OrderNo_FK, new {  = })*@
                        @Html.EditorFor(model => model.OrderNo, new { htmlAttributes = new { @disabled = "true", @class = "form-control font rounded w-100 input-height" } })
                        @*<input type="text" class="form-control font rounded w-100 input-height" disabled>*@
                    </div>
                </div>
                <div class="d-block my-2">
                    <div class="d-inline-block rounded primary-bg text-white py-1 px-3 font w-50">
                        <span>Supplier Code</span>
                    </div>
                    <div class="d-inline-block w-50">
                        @Html.EditorFor(model => model.AccountId_FK, new { htmlAttributes = new { @disabled = "true", @class = "form-control font rounded w-100 input-height" } })
                        @*, new { htmlAttributes= new { @class = "form-control font rounded w-100 input-height" } })*@
                        @*<input type="text" class="form-control font rounded w-100 input-height" disabled>*@
                    </div>
                </div>
                <div class="d-block my-2">
                    <div class="d-inline-block rounded primary-bg text-white py-1 px-3 font w-50">
                        <span>Cost Center</span>
                    </div>
                    <div class="d-inline-block w-50">
                        @Html.EditorFor(model => model.CostCenterId_FK, new { htmlAttributes = new { @disabled = "true", @class = "form-control font rounded w-100 input-height" } })
                        @*<input type="text" class="form-control font rounded w-100 input-height" disabled>*@
                    </div>
                </div>
                <div class="d-block my-2">
                    <div class="d-inline-block rounded primary-bg text-white py-1 px-3 font w-50">
                        <span>Department</span>
                    </div>
                    <div class="d-inline-block w-50">
                        @Html.EditorFor(model => model.DepartmentName, new { htmlAttributes = new { @disabled = "true", @class = "form-control font rounded w-100 input-height" } })
                        @*<input type="text" class="form-control font rounded w-100 input-height" disabled>*@
                    </div>
                </div>
                <div class="d-block my-2">
                    <div class="d-inline-block rounded primary-bg text-white py-1 px-3 font w-50">
                        <span>Order Date</span>
                    </div>
                    <div class="d-inline-block w-50">
                        @Html.EditorFor(model => model.CreatedDate, new { htmlAttributes = new { @disabled = "true", @class = "form-control font rounded w-100 input-height" } })
                        @*<input type="text" class="form-control font rounded w-100 input-height" disabled>*@
                    </div>
                </div>
                <div class="d-block my-2">
                    <div class="d-inline-block rounded primary-bg text-white py-1 px-3 font w-50">
                        <span>Order Status</span>
                    </div>
                    <div class="d-inline-block w-50">
                        @Html.EditorFor(model => model.Status, new { htmlAttributes = new { @disabled = "true", @class = "form-control font rounded w-100 input-height" } })
                        @*<input type="text" class="form-control font rounded w-100 input-height" disabled>*@
                    </div>
                </div>
            </div>
            <div class="col-md-4 ml-auto pr-md-0">
                <div class="d-block my-2">
                    <div class="d-inline-block rounded primary-bg text-white py-1 px-3 font w-50">
                        <span>Supplier Name</span>
                    </div>
                    <div class="d-inline-block w-50">
                        @Html.EditorFor(model => model.SupplierName, new { htmlAttributes = new { @disabled = "true", @class = "form-control font rounded w-100 input-height" } })
                        @*<input type="text" class="form-control font rounded w-100 input-height" disabled>*@
                    </div>
                </div>
                <div class="d-block my-2">
                    <div class="d-inline-block rounded primary-bg text-white py-1 px-3 font w-50">
                        <span>Supplier Address</span>
                    </div>
                    <div class="d-inline-block w-50">
                        @Html.EditorFor(model => model.SupplierAddress, new { htmlAttributes = new { @disabled = "true", @class = "form-control font rounded w-100 input-height" } })
                        @*<input type="text" class="form-control font rounded w-100 input-height" disabled>*@
                    </div>
                </div>
                <div class="d-block my-2">
                    <div class="d-inline-block rounded primary-bg text-white py-1 px-3 font w-50">
                        <span>Total Amount ( CUR )</span>
                    </div>
                    <div class="d-inline-block w-50">
                        @Html.EditorFor(model => model.GrossValue, new { htmlAttributes = new { @disabled = "true", @class = "form-control font rounded w-100 input-height" } })
                        @*<input type="text" class="form-control font rounded w-100 input-height mb-2" disabled>
                            <input type="text" class="form-control font rounded w-100 input-height mb-2" disabled>
                            <input type="text" class="form-control font rounded w-100 input-height mb-2" disabled>*@
                    </div>
                </div>
                <div class="my-2">
                    <ul class="nav nav-bar">
                        <li class="nav-item mr-3">
                            <a href="javascript" class="nav-item"><u>Upload Quote</u></a>
                        </li>
                        <li class="nav-item mr-3">
                            <a href="#" class="nav-item"><u>View Supplier SLA</u></a>
                        </li>
                        <li class="nav-item mr-3">
                            <a href="#" class="nav-item"><u>View MRC</u></a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <h6 class="my-2 primary-text font-weight-bold">Comments</h6>
                    <textarea class="form-control" rows="6" disabled></textarea>
                </div>
            </div>
            <div class="col-md-12 py-3">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered font" id="customFields">
                        <thead>
                            <tr class="primary-bg text-white">

                                <th class="font text-truncate text-center">Product Code</th>
                                <th class="font text-truncate text-center">Name</th>
                                <th class="font text-truncate text-center">Suffix</th>
                                <th class="font text-truncate text-center">Quantity</th>
                                <th class="font text-truncate text-center">Pack Size</th>
                                <th class="font text-truncate text-center">Unit Price (CUR)</th>
                                <th class="font text-truncate text-center">Amount (CUR)</th>
                                <th class="font text-truncate text-center">Exch Rate</th>
                                <th class="font text-truncate text-center">Base Amt (OMR)</th>
                                <th class="font text-truncate text-center">Status</th>
                                <th colspan="3" class="font text-truncate text-center">Read terms conditions history</th>
                            </tr>
                        </thead>
                        <tbody id="transList">
                            <tr>
                                <td class="ndf" colspan="11">No Data Found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            @*<div class="col-md-4">
                    <div class="form-group mb-0">
                        <h6 class="my-2 primary-text font-weight-bold">Notes</h6>
                        <textarea class="form-control" rows="4" disabled></textarea>
                    </div>
                </div>*@

            <div class="col-md-6 ml-auto">
                <div class="d-table h-100 ml-auto">
                    <div class="d-table-cell align-bottom">
                        <ul class="nav nav-bar">
                            <li class="nav-item">@Html.ActionLink("Approve", "Approve", new { id = Model.OrderNo }, htmlAttributes: new { @class = "nav-link border rounded primary-bg font py-1 text-white mr-2" })</li>
                            <li class="nav-item">@Html.ActionLink("Initial", "Approve", new { id = Model.OrderNo }, htmlAttributes: new { @class = "nav-link border rounded primary-bg font py-1 text-white mr-2" })</li>
                            <li class="nav-item">@Html.ActionLink("Reject", "Approve", new { id = Model.OrderNo }, htmlAttributes: new { @class = "nav-link border rounded primary-bg font py-1 text-white mr-2" })</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
@*<p>
        @Html.ActionLink("Edit", "Edit", new { /* id = Model.PrimaryKey */ }) |
        @Html.ActionLink("Approve", "Approve", new { id = Model.OrderNo })
        @Html.ActionLink("Reject", "Index")
    </p>*@
<script>
    //Loading Lines
    $(document).ready(function () {
        console.log(' Data Funtion is Called');
        //$("#OrderNo").on('input', function () {
        var ordernum = $("#OrderNo").val();
        console.log('OrderNo -> ' + ordernum);

        $.ajax({
            url: '/Approve/getOrderlinesByOrderNo',
            type: 'post',
            data: {
                'orderNo': ordernum
            },
            success: function (x) {
                console.log(x);
                if (x.length > 0) {
                    $('#transList').html('');
                    for (var i = 0; i < x.length; i++) {
                        var r = x[i];
                        var html = `
                        <tr>
                            <td>`+ r.ProductId_FK + `</td>
                            <td>`+ r.ProductName + `</td>
                            <td>`+ r.Suffix + `</td>
                            <td>`+ r.Quantity + `</td>
                            <td>`+ r.PackSize + `</td>
                            <td>`+ r.UnitPrice + `</td>
                            <td gross-value="`+ r.UnitPrice + `">` + r.GrossValue + `</td>
                            <td><input type="text" class="form-control font rounded w-100 input-height exchangeRate" placeholder="0" ></td>
                            <td class="baseAmmount">0</td>
                            <td>`+ r.LpoStatus + `</td>
                            <td class="p-0 text-center pt-1">
                                <a href="#" class="px-2 py-1 border font">Select Terms</a>
                                <a href="#" class="px-2 py-1"><u>History</u></a>
                            </td>
                        </tr>
                    `;
                        $('#transList').append(html);
                    }

                } else {
                }

                //$('#ProductId_FK').val(r.ProductId_FK);
                //$('#Suffix').val(r.Suffix);
                //$('#UnitPrice').val(r.UnitPrice);
                //$('#PackSize').val(r.PackSize);
            },
            error: function (r) {
                console.log(r);
            }
        });
    });
</script>